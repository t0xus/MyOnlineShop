@page
@model MyOnlineShop.Pages.MyOrdersModel
@if (HttpContext.Session.GetInt32("UserId").HasValue)
{
    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success" role="alert">
            @TempData["Message"]
        </div>
    }

    <h1>Meine Bestellungen</h1>
    <br />

    <form id="cancelForm" method="post">
        @foreach (var item in Model.orders)
        {
            <h2> Bestelldatum @item.order_date | Gesamtpreis @item.total</h2>

            @if (item.shipped == false)
            {
                <button type="button" class="btn btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#confirmCancelModal"
                        data-dealid="@item.id">
                    Stornieren
                </button>
            }

            <table class="table mt-2">
                <thead>
                    <tr>
                        <th>Produkt</th>
                        <th>Anzahl</th>
                        <th>Price Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item2 in item.orderedItems)
                    {
                        <tr>
                            <td>@item2.name</td>
                            <td>@item2.quantity</td>
                            <td>@item2.price</td>
                        </tr>
                    }
                </tbody>
            </table>
        }

        <input type="hidden" id="hiddenDealId" name="deal_id" />
    </form>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="confirmCancelModal" tabindex="-1" aria-labelledby="confirmCancelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmCancelModalLabel">Kauf stornieren</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
                </div>
                <div class="modal-body">
                    Bist du sicher, dass du den Kauf wirklich stornieren möchtest?<br>
                    <small class="text-muted">Diese Aktion kann nicht rückgängig gemacht werden.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="button" class="btn btn-danger" id="confirmCancelBtn">Ja, stornieren</button>
                </div>
            </div>
        </div>
    </div>


}
